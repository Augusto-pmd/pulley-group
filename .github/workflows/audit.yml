name: ğŸ” Pulley Group - AuditorÃ­a CI

on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]

jobs:
  audit:
    name: AuditorÃ­a Completa
    runs-on: ubuntu-latest
    
    steps:
      # a) checkout
      - name: ğŸ“¥ Checkout cÃ³digo
        uses: actions/checkout@v4

      # b) setup-node
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 'lts/*'
          cache: 'npm'

      # c) npm install
      - name: ğŸ”§ Instalar dependencias
        run: npm install

      # d) npm run build
      - name: ğŸ—ï¸ Build del proyecto
        run: npm run build

      # e) npm run lint (solo si existe script)
      - name: ğŸ” Lint del cÃ³digo
        run: |
          if grep -q '"lint"' package.json; then
            npm run lint
          else
            echo "âš ï¸  Script 'lint' no existe, omitiendo..."
          fi

      # f) npm run typecheck (solo si existe script)
      - name: ğŸ“ TypeCheck (TypeScript)
        run: |
          if grep -q '"typecheck"' package.json; then
            npm run typecheck
          else
            echo "âš ï¸  Script 'typecheck' no existe, omitiendo..."
          fi

      # g) smoke check: render de app
      - name: ğŸ§ª Smoke Check - Render de app
        run: npm run audit:smoke-render

      # h) custom checks Pulley
      - name: ğŸ” Custom Check - Buscar uso de auth
        run: npm run audit:architecture

      - name: ğŸ”— Custom Check - Validar imports
        run: npm run audit:imports

